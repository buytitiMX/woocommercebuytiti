(()=>{"use strict";var e,t={847:()=>{const e=window.wp.blocks,t=window.React,a=window.wp.i18n,r=window.wp.blockEditor,c=window.wp.components,{useBlockProps:o}=wp.blockEditor,i=JSON.parse('{"u2":"buytiti/buytitiwoocommerce"}');(0,e.registerBlockType)(i.u2,{edit:({attributes:e,setAttributes:o})=>{const{products:i=[],categories:l,selectedCategory:s,filter:n}=e,[m,d]=(0,t.useState)(!0),[u,p]=(0,t.useState)(!1),_=(()=>{let e=i;return s&&(e=e.filter((e=>e.categories&&e.categories.some((e=>e.id===parseInt(s,10)))))),"on_sale"===n&&(e=e.filter((e=>e.prices.sale_price!==e.prices.regular_price))),e})(),g=u?_:_.slice(0,10);(0,t.useEffect)((()=>{s?(async()=>{try{let e=[];for(let t=1;t<=5;t++){const a=await fetch(`http://localhost/wordpress/wp-json/wc/store/products?category=${s}&per_page=100&page=${t}`);if(!a.ok)throw new Error(`Error en la solicitud: ${a.statusText}`);const r=await a.json();if(e=[...e,...r],r.length<100)break}const t=(await Promise.all(e.map((async e=>{try{const t=await fetch(`http://localhost/wordpress/wp-json/wp/v2/product/${e.id}`);if(!t.ok)throw new Error(`Error en la solicitud de producto: ${t.statusText}`);const a=await t.json(),r=E(a.date),c=e.attributes[0]?.name||"Buytiti",o=e.categories[0]?.name;return{...e,isNew:r,attributeName:c,categoryName:o}}catch(t){return console.error(`Error al obtener información del producto ${e.id}: ${t.message}`),e}})))).sort(((e,t)=>{const a=new Date(e.date).getTime();return new Date(t.date).getTime()-a}));o({products:t}),d(!1)}catch(e){console.error("Error fetching WooCommerce products:",e.message),d(!1)}})():(async()=>{try{let e=[];for(let t=1;t<=1;t++){const a=await fetch(`http://localhost/wordpress/wp-json/wc/store/products?per_page=10&page=${t}`);if(!a.ok)throw new Error(`Error en la solicitud: ${a.statusText}`);const r=await a.json();e=[...e,...r]}const t=(await Promise.all(e.map((async e=>{try{const t=await fetch(`http://localhost/wordpress/wp-json/wp/v2/product/${e.id}`);if(!t.ok)throw new Error(`Error en la solicitud de producto: ${t.statusText}`);const a=await t.json(),r=E(a.date),c=e.attributes[0]?.name||"Buytiti",o=e.categories[0]?.name;return{...e,isNew:r,attributeName:c,categoryName:o}}catch(t){return console.error(`Error al obtener información del producto ${e.id}: ${t.message}`),e}})))).sort(((e,t)=>{const a=new Date(e.date).getTime();return new Date(t.date).getTime()-a}));o({products:t}),d(!1)}catch(e){console.error("Error fetching recent WooCommerce products:",e.message),d(!1)}})(),(async()=>{try{const e=await fetch("http://localhost/wordpress/wp-json/wc/store/products/categories");if(!e.ok)throw new Error(`Error en la solicitud: ${e.statusText}`);const t=await e.json();o({categories:t})}catch(e){console.error("Error fetching WooCommerce categories:",e.message)}})()}),[o,s]);const E=e=>{const t=new Date(e).getTime();return(new Date).getTime()-t<6048e5},[v,w]=(0,t.useState)(!1),[y,b]=(0,t.useState)(!1);return(0,t.createElement)("div",{...(0,r.useBlockProps)()},(0,t.createElement)(r.InspectorControls,null,(0,t.createElement)(c.PanelBody,{title:(0,a.__)("Filtro de categoría","tu-texto-localizacion")},(0,t.createElement)(c.SelectControl,{label:(0,a.__)("Selecciona una categoría","tu-texto-localizacion"),value:s,options:[{label:"Ninguna",value:""},...l.map((e=>({label:e.name,value:e.id})))],onChange:e=>{o({selectedCategory:e})}}),(0,t.createElement)(c.SelectControl,{label:(0,a.__)("Selecciona un filtro","tu-texto-localizacion"),value:n,options:[{label:"Ninguno",value:""},{label:"En oferta",value:"on_sale"},...l.map((e=>({label:e.name,value:e.id})))],onChange:e=>o({filter:e})}),(0,t.createElement)(c.Button,{isPrimary:!0,onClick:()=>{o({filter:!0})}},(0,a.__)("Filtrar","tu-texto-localizacion")),n&&(0,t.createElement)(c.Button,{onClick:()=>{o({filter:!1,selectedCategory:""})}},(0,a.__)("Limpiar filtro","tu-texto-localizacion"))),(0,t.createElement)(c.RadioControl,{label:(0,a.__)("Cantidad de productos","tu-texto-localizacion"),selected:u?"all":"10",options:[{label:"10",value:"10"},{label:"Todos",value:"all"}],onChange:t=>{return p(a="all"===t),void o({...e,showAllProducts:a});var a}})),m?(0,t.createElement)("p",null,(0,a.__)("Cargando productos...","tu-texto-localizacion")):(0,t.createElement)("div",null,v&&(0,t.createElement)("div",{className:"alert",style:{backgroundColor:"#FF7942",color:"white"}},"Se añadió tu producto correctamente"),y&&(0,t.createElement)("div",{className:"alert",style:{backgroundColor:"#FF0000",color:"white"}},y),(0,t.createElement)("div",{className:"grid-container"},g.map((e=>(0,t.createElement)("div",{key:e.id,className:"product-item","data-product-id":e.id},(0,t.createElement)("div",{className:"image-container"},e.add_to_cart&&e.add_to_cart.maximum&&e.add_to_cart.maximum<10&&(0,t.createElement)("div",{className:"stock-alert"},(0,a.__)("Pocas existencias","tu-texto-localizacion")),e.isNew&&(0,t.createElement)("div",{className:"new-label"},(0,a.__)("Nuevo","tu-texto-localizacion")),e.prices.sale_price!==e.prices.regular_price&&(0,t.createElement)("div",null,(0,t.createElement)("div",{className:"offer-box"},(0,a.__)("Oferta","tu-texto-localizacion")),(0,t.createElement)("div",{className:"discount-box"},`-${Math.round((e.prices.regular_price-e.prices.sale_price)/e.prices.regular_price*100)}%`)),(0,t.createElement)("a",{href:e.permalink,target:"_blank",rel:"noopener noreferrer"},(0,t.createElement)("img",{className:"img-size",src:e.images[0].src,alt:e.name})),e.add_to_cart&&e.add_to_cart.maximum&&(0,t.createElement)("div",{className:"stock-info"},(0,a.__)("Disponibles","tu-texto-localizacion"),":"," ",e.add_to_cart.maximum)),(0,t.createElement)("div",{className:"attribute-category"},(0,t.createElement)("span",null,e.attributeName),e.categoryName&&(0,t.createElement)("span",null," - "),e.categoryName&&(0,t.createElement)("span",{className:"categoria"},e.categoryName)),(0,t.createElement)("div",{className:"name-buytiti"},e.name),(0,t.createElement)("div",{className:"sku"},"SKU: ",e.sku),e.prices.sale_price!==e.prices.regular_price?(0,t.createElement)("div",{className:"container-price"},(0,t.createElement)("div",{className:"regular-price"},(0,t.createElement)("del",null,e.prices.currency_prefix,(e.prices.regular_price/100).toFixed(2))),(0,t.createElement)("div",{className:"sale-price"},e.prices.currency_prefix,(e.prices.sale_price/100).toFixed(2))):(0,t.createElement)("div",{className:"price"},e.prices.currency_prefix,(e.prices.regular_price/100).toFixed(2)),(0,t.createElement)("div",{className:"quantity-container"},(0,t.createElement)("label",{htmlFor:`quantity-${e.id}`},(0,a.__)("","tu-texto-localizacion")),(0,t.createElement)("div",{className:"quantity-input-container"},(0,t.createElement)("input",{className:"number-input",type:"number",id:`quantity-${e.id}`,name:`quantity-${e.id}`,min:"1",max:e.add_to_cart?e.add_to_cart.maximum:void 0,defaultValue:"1",onChange:t=>{e.add_to_cart&&e.add_to_cart.maximum&&t.target.value>e.add_to_cart.maximum&&(t.target.value=e.add_to_cart.maximum)}}),(0,t.createElement)(c.Button,{className:"btn-addtocart",isPrimary:!0,onClick:()=>(async e=>{const t=document.getElementById(`quantity-${e}`),a=t?parseInt(t.value,10):1;try{const t=_.find((t=>t.id===e));if(t.add_to_cart&&t.add_to_cart.maximum&&a>t.add_to_cart.maximum)return b(`Error: Este artículo tiene solo ${t.add_to_cart.maximum} unidades en stock.`),void setTimeout((()=>{b(!1)}),4e3);const r=await fetch(`/wordpress/carrito/?add-to-cart=${e}&quantity=${a}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Basic "+btoa("ck_ff9474de189b37a7aa63b4a9ea3279c5685d3749:cs_aaab9f6527fdc3f132bdb2c10516d08e1c4222bd")},body:JSON.stringify({product_id:e,quantity:a})});if(!r.ok)throw new Error(`Error al añadir el producto al carrito: ${r.statusText}`);w(!0),setTimeout((()=>{w(!1)}),5e3),console.log(`Producto agregado al carrito: ${e}`)}catch(e){console.error("Error al añadir el producto al carrito:",e.message),b(`Error: ${e.message}`),setTimeout((()=>{b(!1)}),5e3)}})(e.id)},(0,a.__)("Añadir al carrito","tu-texto-localizacion"))))))))))},save:({attributes:e})=>{const{products:r,selectedCategory:c,filter:i,showAllProducts:l}=e,s=(()=>{let e=r;return c&&(e=e.filter((e=>e.categories&&e.categories.some((e=>e.id===parseInt(c,10)))))),"on_sale"===i&&(e=e.filter((e=>e.prices.sale_price!==e.prices.regular_price))),e})(),n=l?s:s.slice(0,10);return(0,t.createElement)("div",{...o.save()},(0,t.createElement)("div",{id:"success-alert",style:"display: none; background-color: #28a745; color: white;"},"✓ Se añadió tu producto correctamente"),(0,t.createElement)("div",{id:"error-alert",style:"display: none; background-color: red; color: white;"},"X Error"),(0,t.createElement)("div",{className:"grid-container"},n.map((e=>(0,t.createElement)("div",{key:e.id,className:"product-item","data-product-id":e.id},(0,t.createElement)("div",{className:"image-container"},e.add_to_cart&&e.add_to_cart.maximum&&e.add_to_cart.maximum<10&&(0,t.createElement)("div",{className:"stock-alert"},(0,a.__)("Pocas existencias","tu-texto-localizacion")),e.isNew&&(0,t.createElement)("div",{className:"new-label"},(0,a.__)("Nuevo","tu-texto-localizacion")),e.prices.sale_price!==e.prices.regular_price&&(0,t.createElement)("div",null,(0,t.createElement)("div",{className:"offer-box"},(0,a.__)("Oferta","tu-texto-localizacion")),(0,t.createElement)("div",{className:"discount-box"},`-${Math.round((e.prices.regular_price-e.prices.sale_price)/e.prices.regular_price*100)}%`)),(0,t.createElement)("a",{href:e.permalink,target:"_blank",rel:"noopener noreferrer"},(0,t.createElement)("img",{className:"img-size",src:e.images[0].src,"data-original-src":e.images[0].src,alt:e.name})),e.add_to_cart&&e.add_to_cart.maximum&&(0,t.createElement)("div",{className:"stock-info"},(0,a.__)("Disponibles","tu-texto-localizacion"),":"," ",e.add_to_cart.maximum)),(0,t.createElement)("div",{className:"attribute-category"},(0,t.createElement)("span",null,e.attributeName),e.categoryName&&(0,t.createElement)("span",null," - "),e.categoryName&&(0,t.createElement)("span",{className:"categoria"},e.categoryName)),(0,t.createElement)("div",{className:"name-buytiti"},e.name),(0,t.createElement)("div",{className:"sku"},"SKU: ",e.sku),e.prices.sale_price!==e.prices.regular_price?(0,t.createElement)("div",{className:"container-price"},(0,t.createElement)("div",{className:"regular-price"},(0,t.createElement)("del",null,e.prices.currency_prefix,(e.prices.regular_price/100).toFixed(2))),(0,t.createElement)("div",{className:"sale-price"},e.prices.currency_prefix,(e.prices.sale_price/100).toFixed(2))):(0,t.createElement)("div",{className:"price"},e.prices.currency_prefix,(e.prices.regular_price/100).toFixed(2)),(0,t.createElement)("div",{className:"quantity-container"},(0,t.createElement)("label",{htmlFor:`quantity-${e.id}`},(0,a.__)("","tu-texto-localizacion")),(0,t.createElement)("div",{className:"quantity-input-container"},(0,t.createElement)("input",{className:"number-input",type:"number",id:`quantity-${e.id}`,name:`quantity-${e.id}`,min:"1",max:e.add_to_cart?e.add_to_cart.maximum:void 0,Value:"1","data-max":e.add_to_cart?e.add_to_cart.maximum:void 0}),(0,t.createElement)("button",{className:"btn-addtocart"},(0,a.__)("Añadir al carrito","tu-texto-localizacion")))))))))}})}},a={};function r(e){var c=a[e];if(void 0!==c)return c.exports;var o=a[e]={exports:{}};return t[e](o,o.exports,r),o.exports}r.m=t,e=[],r.O=(t,a,c,o)=>{if(!a){var i=1/0;for(m=0;m<e.length;m++){for(var[a,c,o]=e[m],l=!0,s=0;s<a.length;s++)(!1&o||i>=o)&&Object.keys(r.O).every((e=>r.O[e](a[s])))?a.splice(s--,1):(l=!1,o<i&&(i=o));if(l){e.splice(m--,1);var n=c();void 0!==n&&(t=n)}}return t}o=o||0;for(var m=e.length;m>0&&e[m-1][2]>o;m--)e[m]=e[m-1];e[m]=[a,c,o]},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={826:0,431:0};r.O.j=t=>0===e[t];var t=(t,a)=>{var c,o,[i,l,s]=a,n=0;if(i.some((t=>0!==e[t]))){for(c in l)r.o(l,c)&&(r.m[c]=l[c]);if(s)var m=s(r)}for(t&&t(a);n<i.length;n++)o=i[n],r.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return r.O(m)},a=globalThis.webpackChunkbuytitiwoocommerce=globalThis.webpackChunkbuytitiwoocommerce||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var c=r.O(void 0,[431],(()=>r(847)));c=r.O(c)})();